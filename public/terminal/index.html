<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <title>Termcast</title>
  <script src="../js/jquery-2.0.1.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="../js/canvas.js" type="text/javascript" charset="utf-8"></script>
  <link rel="stylesheet" href="../css/terminal.css" type="text/css" media="screen" charset="utf-8">
</head>
<body>
<div id="terminal">
  <canvas id="terminal_canvas">
    <div id="container"> </div>
  </canvas>
</div>
<div id="notice"> </div>

  <script type="text/javascript" charset="utf-8">
    var canvas = document.getElementById('terminal_canvas');
    var socket = io.connect(window.location.origin);
    var stream_id = window.location.search.slice(1);
    $('#terminal').hide();
    socket.emit('id', stream_id);
    socket.on('notfound', function () {
      window.location = '/';
    });
    socket.on('closing', function() { socket.end(); window.location = '/'; });
    socket.on('ready', function () {
      $('#terminal').show();
      $.get('/data/stream', {id: stream_id}).done(function(data) {
        socket.emit('ready');
        $('#terminal').show();
        canvas.streamer_username = data.user;
        init_canvas(canvas, data.geometry[0], data.geometry[1]);
      });
    });
    socket.on('draw', function(data) {
      update_canvas(data, canvas.getContext('2d'), screen);
      //console.log(data);
    });
  </script>
</body>
</html>
